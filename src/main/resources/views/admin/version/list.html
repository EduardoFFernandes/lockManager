<!DOCTYPE HTML>
<html xmlns="http://www.w3.org/1999/xhtml"
    xmlns:th="http://www.thymeleaf.org"
    xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
    layout:decorate="~{admin/_layout/main_layout}">

<div layout:fragment="content">

    <div class="row">
        <div class="col-12">
            <div class="page-title-box">
                <h4 class="page-title float-left"
                    th:text="#{menu.version.list}"></h4>

                <ol class="breadcrumb float-right">
                    <li class="breadcrumb-item"><a th:href=@{#}
                        th:text="#{home}"></a></li>
                    <li class="breadcrumb-item active"
                        th:text="#{menu.version.list}"></li>
                </ol>

                <div class="clearfix"></div>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col-12">
            <div class="card mt-4">
                <div class="card-body table-responsive">

                    <div class="row">
                        <div class="col-sm-12 col-md-11">
                            <h4 class="m-t-0 header-title mb-5"
                                th:text="#{menu.version.list.desc}"></h4>
                        </div>
                        <div
                            class="col-sm-12 col-md-1 text-right pr-4 btn-add">
                            <a th:href="@{/admin/version/edit}"
                                class="tooltip-left"
                                th:title="#{version.add}"> <i
                                class="ion ion-ios-add-circle"></i>
                            </a>
                        </div>
                    </div>

                    <table id="datatable"
                        class="table table-hover table-bordered">

                        <thead class="thead-light ">
                            <tr
                                th:if="${objects == null || objects?.isEmpty()}">
                                <th th:text="#{no.records.found}"></th>
                            </tr>
                            <tr th:if="${!objects?.isEmpty()}">
                                <th data-priority="1"
                                    th:text="#{registry.date}"></th>
                                <th th:text="#{firmware.version}"></th>
                                <th th:text="#{menu}" data-priority="2"
                                    class="actions">&nbsp;</th>
                            </tr>
                        </thead>

                        <tbody>
                            <tr th:each="object : ${objects}">
                                <td th:text="${#dates.format(object.registryDate, 'dd/MM/yyyy')}"></td>
                                <td>
                                    <span 
                                        class="link btn p-0"
                                        th:attr="onclick=${'javascript: getReleaseNotes(' + object.id + ')'}" 
                                        th:text="${object.name}"></span>
                                </td>
                                <td
                                    class="actions lock-actions pb-0 pt-10">
                                    <a class="action-icon edit"
                                    data-toggle="dropdown" href="#"
                                    role="button"> <i
                                        class="mdi mdi-menu icon-resize"></i>
                                </a>
                                    <div
                                        class="dropdown-menu dropdown-menu-left profile-dropdown">
                                        <ul class="list-inline mb-0">
                                            <li
                                                class="dropdown notification-list">
                                                <a
                                                th:href="|@{/admin/version/edit}/${object.id}|"
                                                class="dropdown-item notify-item pt-1 pb-1 action-icon edit">
                                                    <i class="fas fa-edit font-size-16 tab-width"></i>
                                                    <span th:text="#{edit}"></span>
                                                </a> 
                                                <span class="checkAssociations"
                                                data-toggle="modal"
                                                data-target="#modalDeleteWarning"> 
                                                    <a href="#"
                                                       class="delete dropdown-item notify-item pt-1 pb-1 action-icon edit"
                                                       th:title="#{delete}"
                                                       th:data-url="@{/admin/version/delete}"
                                                       th:data-id="${object.id}">
                                                       <i class="far fa-trash-alt font-size-16 tab-width"></i>
                                                       <span th:text="#{delete}"></span>
                                                    </a>
                                                </span>
                                            </li>
                                        </ul>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <!-- end card-body -->
            </div>
            <!-- end card -->
        </div>
        <!-- end col -->
    </div>
    <!-- end row -->
    <script th:inline="javascript">
    
        var urlCheckAssociations = [[@{${T(brisa.lockmanager.Routes).API_EXISTS_VERSION_ASSOCIATIONS}}]]; // used in bottom.js

        $(function() {
            
            /* $('#datatable tbody').on('click', 'tr', function () {
                
            }); */

            var columnsDefinitions = [ 
                { targets : [ 2 ], orderable : false } 
            ];
    
            if ([[${!objects?.isEmpty()}]]) {
                $('#datatable').DataTable(
                    buildDataTable(columnsDefinitions)
                );
            }
            
            $('#modalDeleteWarning').on('hidden.bs.modal', function () {
                $('#modalDeleteDesc').html([[#{message.warning.delete.desc}]]);
                $('#modalDeleteWarning').find(':submit').attr('disabled', false);
                $('#modalDeleteWarning').find(':submit').css('cursor', 'pointer');
            });
        });
        
        function getReleaseNotes(id) {
            $.ajax({
                url: [[@{${T(brisa.lockmanager.Routes).API_RELEASE_NOTES}}]] + "/" + id,
                success: function(response) {
                    $('#releaseNotesTextarea').val(response.releaseNotes);
                    $('#releaseNotesModalLabel').html([[#{version}]] + ' ' + response.name);
                    $('#modalReleaseNotes').modal('show')
                }
            });
        }
        </script>
</div>

</html>
<!-- end fragment -->